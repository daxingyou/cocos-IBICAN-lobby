var rigger,rigger,rigger;!function(t){function e(){this.applicationName="Untitled App",this.srcRoot="./src",this.libPathes=[],this.includingPathes=[],this.dtsPathes=[],this.outRoot="./dist",this.binRoot="./bin",this.configBuildRoot=""}(t.config||(t.config={})).ApplicationConfig=e}(rigger=rigger||{}),function(t){function e(){}(t.config||(t.config={})).DependentComponentInfo=e}(rigger=rigger||{}),function(t){function e(){this.fullName="",this.customServicesRoot=[]}(t.config||(t.config={})).PackageConfig=e}(rigger=rigger||{});var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),rigger,rigger,rigger,rigger,rigger,rigger,rigger,rigger,rigger,rigger;!function(t){var e,i,r;function n(){return i.call(this)||this}e=t.config||(t.config={}),i=e.DependentComponentInfo,__extends(n,i),r=n,e.ServiceConfig=r}(rigger=rigger||{}),function(rigger){var service;!function(service){var AbsService=function(){function AbsService(){this.messageListenerMap={},this.readyFlag=!1,this._serviceStatus=rigger.ServiceStatus.Starting,this.plugins=[]}return AbsService.prototype.getApplication=function(){return this.application},AbsService.prototype.setApplication=function(t){this.application=t,AbsService.setApplication(t)},AbsService.setApplication=function(t){AbsService.application=t},AbsService.getRunningService=function(t){return AbsService.application.getRunningService(t)},AbsService.prototype.start=function(t,e,i){this.mConfig=e,this.startPlugins(new rigger.RiggerHandler(this,this.onAllPluginsStartComplete,[t,i]),0,i)},AbsService.prototype.stop=function(t){this.stopPlugins(t),this.setApplication(null),this.clearMessages()},AbsService.prototype.reStart=function(t){this.onReStart(t)},AbsService.prototype.onMessage=function(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];var o=this.messageListenerMap[t];(o=o||(this.messageListenerMap[t]=new rigger.utils.ListenerManager)).on(e,i,r)},AbsService.prototype.offMessage=function(t,e,i){var r=this.messageListenerMap[t];r&&r.off(e,i)},AbsService.prototype.offAllMessages=function(t,e,i){var r=this.messageListenerMap[t];r&&r.offAll(e,i)},AbsService.prototype.clearMessages=function(){for(var t in this.messageListenerMap)this.messageListenerMap[t].clear(),delete this.messageListenerMap[t];this.messageListenerMap={}},AbsService.prototype.dispatchMessage=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.messageListenerMap[t];r&&r.execute.apply(r,e)},AbsService.prototype.extendMethod=function(t){var e=this.extendedMethodMap;(e=e||(this.extendedMethodMap={}))[t]||(e[t]={prefixPlugins:[],suffixPlugins:[]})},AbsService.prototype.executeMethodPrefixExtension=function(t,e){var i=this.extendedMethodMap[t].prefixPlugins;return this.executeMethodExtension(i,t,e)},AbsService.prototype.executeMethodSuffixExtension=function(t,e,i){var r=this.extendedMethodMap[t].suffixPlugins;return this.executeMethodExtension(r,t,e,i)},AbsService.prototype.hasAnyPlugins=function(t){return this.extendedMethodMap[t]&&(0<this.extendedMethodMap[t].prefixPlugins.length||0<this.extendedMethodMap[t].suffixPlugins.length)},AbsService.prototype.isReady=function(){return this.readyFlag},AbsService.prototype.setServiceStatus=function(t){return this._serviceStatus=t},AbsService.prototype.getServiceStatus=function(){return this._serviceStatus},Object.defineProperty(AbsService.prototype,"config",{get:function(){return this.mConfig},enumerable:!0,configurable:!0}),AbsService.prototype.getConfig=function(){return this.mConfig},AbsService.prototype.startPlugins=function(t,e,i){if(!this.mConfig)return t.success();var r=this.mConfig.plugins;if(!r)return t.success();if(e>=r.length)return t.success();var n=new(this.makePluginClass(r[e].fullName));n.setOwner(this),n.start(new rigger.RiggerHandler(this,this.onPluginStartComplete,[t,e+1,i,n]),i)},AbsService.prototype.onPluginStartComplete=function(t,e,i,r,n){if(0!==n)throw new Error("failed to start plugin!");this.plugins.push(r),this.addPluginToMap(r),this.startPlugins(t,e,i)},AbsService.prototype.onAllPluginsStartComplete=function(t,e){this.onStart(t,e)},AbsService.prototype.stopPlugins=function(t){if(this.plugins.length<=0)return delete this.extendedMethodMap,void this.onAllPluginsStopComplete(t);var e=this.plugins.pop();e.stop(new rigger.RiggerHandler(this,this.onPluginStopComplete,[e,t]))},AbsService.prototype.onPluginStopComplete=function(t,e,i){t.setOwner(null),0!==i&&console.log("error when stop plugin, error code:"+i),this.stopPlugins(e)},AbsService.prototype.onAllPluginsStopComplete=function(t){this.onStop(t)},AbsService.prototype.addPluginToMap=function(t){var e,i=this.extendedMethodMap;if(i)for(var r in i)i.hasOwnProperty(r)&&"function"==typeof this[r]&&"function"==typeof t[r]&&(e=i[r],rigger.PluginMode.Prefix===t.getPluginMode()?e.prefixPlugins.push(t):e.suffixPlugins.push(t))},AbsService.prototype.executeMethodExtension=function(t,e,i,r){var n;void 0===r&&(r=null);for(var o=0;o<t.length;++o)r=(n=t[o])[e].apply(n,i.concat([r]));return r},AbsService.prototype.makePluginClass=function(fullName){return rigger.BaseApplication.pluginFullNameDefinitionMap&&rigger.BaseApplication.pluginFullNameDefinitionMap[fullName]?rigger.BaseApplication.pluginFullNameDefinitionMap[fullName]:eval(fullName)},AbsService.serviceName=void 0,AbsService.application=null,AbsService}();service.AbsService=AbsService}(service=rigger.service||(rigger.service={}))}(rigger=rigger||{}),function(t){var e=(i.prototype.start=function(t,e){this.onStart(t,e)},i.prototype.stop=function(t){this.onStop(t)},i.prototype.reStart=function(t){this.onRestart(t)},i.prototype.setOwner=function(t){this.owner=t},i.prototype.getOwner=function(){return this.owner},i.prototype.getPluginMode=function(){return this.pluginMode},i);function i(){this.pluginMode=t.PluginMode.Suffix}t.AbsServicePlugin=e}(rigger=rigger||{}),function(rigger){var ServiceStatus,_a;_a=ServiceStatus=rigger.ServiceStatus||(rigger.ServiceStatus={}),_a[_a.Starting=1]="Starting",_a[_a.Running=2]="Running";var BaseApplication=function(){function BaseApplication(){this._serviceMap={}}return Object.defineProperty(BaseApplication,"instance",{get:function(){return BaseApplication.mInstance||(BaseApplication.mInstance=new BaseApplication),BaseApplication.mInstance},enumerable:!0,configurable:!0}),BaseApplication.prototype.start=function(t,e){this.startKernelService(new rigger.RiggerHandler(this,this.onAllServicesReady,[t]),e)},BaseApplication.prototype.stop=function(){},BaseApplication.prototype.setConfig=function(t){this.applicationConfig=t},BaseApplication.prototype.getConfig=function(){return this.applicationConfig},BaseApplication.prototype.startService=function(t,e,i,r){void 0===i&&(i=null);var n=t.serviceName,o=this.getService(n);if(o)return o.getServiceStatus()===ServiceStatus.Running;if((o=new t).setServiceStatus(ServiceStatus.Starting),this.registerService(n,o),i)this.startServiceWithConfig(t,o,e,i,r);else{var s=this.getRunningService(rigger.service.ConfigService.serviceName);if(s){var a=s.getServiceConfig(n);this.startServiceWithConfig(t,o,e,a,r)}else{if(n!==rigger.service.ConfigService.serviceName&&n!==this.newConfigServiceName)throw new Error("Non-kernel service should be start after ConfigService");this.startServiceWithConfig(t,o,e,null,r)}}return!1},BaseApplication.prototype.startServiceWithConfig=function(t,e,i,r,n){r&&(rigger.utils.Utils.isNullOrEmpty(r.fullName)?r.fullName=t.serviceName:t.serviceName=r.fullName);var o=r?r.services:[];if(o&&0<o.length)for(var s=0;s<o.length;++s){var a=this.makeServiceClass(o[s].fullName);if(!this.startService(a,new rigger.RiggerHandler(this,this.startServiceWithConfig,[t,e,i,r,n]),null,n))return}this.doStartService(t,e,r,i,n)},BaseApplication.prototype.getService=function(t){return t=this.getRealServiceName(t),this._serviceMap[t]},BaseApplication.prototype.getRunningService=function(t){var e=this.getService(t);return e&&e.getServiceStatus()===ServiceStatus.Running?e:null},BaseApplication.prototype.registerService=function(t,e){return!this.isServiceRegistered(t)&&(this._serviceMap[t]=e,!0)},BaseApplication.prototype.unregisterService=function(t){return!!this.isServiceRegistered(t)&&(delete this._serviceMap[t],!0)},BaseApplication.prototype.isServiceRegistered=function(t){return!!this.getService(t)},BaseApplication.prototype.isServiceRunning=function(t){var e=this.getService(t);return!!e&&e.getServiceStatus()===ServiceStatus.Running},BaseApplication.prototype.onAllServicesReady=function(t){t.success()},BaseApplication.prototype.makeServiceClass=function(t){if(!BaseApplication.replacedServiceMap)return this.doMakeServiceClass(t);var e=BaseApplication.replacedServiceMap[t];return rigger.utils.Utils.isNullOrUndefined(e)?this.doMakeServiceClass(t):(rigger.service.ConfigService.serviceName===t&&(this.newConfigServiceName=e.serviceName),e)},BaseApplication.prototype.doMakeServiceClass=function(serviceName){if(!BaseApplication.serviceFullNameDefinitionMap)return eval(serviceName);var Def=BaseApplication.serviceFullNameDefinitionMap[serviceName];return Def||eval(serviceName)},BaseApplication.prototype.getRealServiceName=function(t){if(!BaseApplication.replacedServiceMap)return t;var e=BaseApplication.replacedServiceMap[t];return rigger.utils.Utils.isNullOrUndefined(e)?t:e.serviceName},BaseApplication.prototype.onKernelServiceReady=function(t,e){console.log("KernelService Ready!"),this.startNonKernelService(t,e)},BaseApplication.prototype.startKernelService=function(t,e){var i=new rigger.config.ServiceConfig,r=new rigger.config.ServiceConfig;r.fullName=rigger.service.ConfigService.serviceName;var n=new rigger.config.ServiceConfig;n.fullName=rigger.service.PoolService.serviceName;var o=new rigger.config.ServiceConfig;o.fullName=rigger.service.EventService.serviceName,i.services=[r,n,o],this.startService(this.makeServiceClass(rigger.service.KernelService.serviceName),new rigger.RiggerHandler(this,this.onKernelServiceReady,[t,e]),i,e)},BaseApplication.prototype.startNonKernelService=function(t,e){this.getRunningService(rigger.service.ConfigService.serviceName).getApplicationConfig(new rigger.RiggerHandler(this,this.startApplicationDependentService,[0,t,e]))},BaseApplication.prototype.startApplicationDependentService=function(t,e,i,r){if(!r)throw new Error("faild to get application config.");var n=r.services;if(n.length<=t)return e.run();for(var o,s=!0,a=0;a<n[t].length;++a)(o=this.makeServiceClass(n[t][a].fullName)).serviceName=n[t][a].fullName,this.startService(o,new rigger.RiggerHandler(this,this.startApplicationDependentService,[t,e,i,r]),null,i)||(s=!1);s&&this.startApplicationDependentService(t+1,e,i,r)},BaseApplication.prototype.doStartService=function(t,e,i,r,n){e.setApplication(this),console.log("starting "+t.serviceName),e.start(new rigger.RiggerHandler(this,this.onServiceStartComplete,[t,e,r]),i,n)},BaseApplication.prototype.onServiceStartComplete=function(t,e,i,r){0===r&&(e.setServiceStatus(ServiceStatus.Running),console.log(t.serviceName+" is ready."),i.run())},BaseApplication.replacedServiceMap={},BaseApplication.serviceFullNameDefinitionMap={},BaseApplication.pluginFullNameDefinitionMap={},BaseApplication}();rigger.BaseApplication=BaseApplication}(rigger=rigger||{}),function(t){var e;(e=t.PluginMode||(t.PluginMode={}))[e.Prefix=1]="Prefix",e[e.Suffix=2]="Suffix"}(rigger=rigger||{}),function(o){var t=(Object.defineProperty(s.prototype,"caller",{get:function(){return this._caller},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"method",{get:function(){return this._method},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"once",{get:function(){return this._once},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"args",{get:function(){return this._args},enumerable:!0,configurable:!0}),s.prototype.dispose=function(){this._caller=null,this._method=null,this._args=null},s.create=function(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=!0);var n=o.service.PoolService.getItem(s.riggerHandlerSign);return n?(n._caller=t,n._method=e,n._args=i,n._once=r,n):new s(t,e,i,r)},s.recover=function(t){t.dispose(),o.service.PoolService.recover(s.riggerHandlerSign,t)},s.prototype.recover=function(){s.recover(this)},s.prototype.run=function(){if(this._method)return this._method.apply(this._caller,this._args)},s.prototype.runWith=function(t){return t?this._method?this._args?this._method.apply(this._caller,this._args.concat(t)):this._method.apply(this._caller,t):null:this.run()},s.prototype.success=function(){this.runWith([0])},s.prototype.fail=function(){this.runWith([1])},s.riggerHandlerSign="_riggerHandlerSign",s);function s(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=!1),this._once=!0,this._caller=t,this._method=e,this._args=i,this._once=r}o.RiggerHandler=t}(rigger=rigger||{}),function(i){var n,t;function e(t){this._dataView=null,this._allocated=8,this._pos=0,this._length=0,this._u8d=null,this.littleEndian=!1,this._allocated=8,this._pos=0,this._length=0,this.littleEndian=!1,t?(this._u8d=new Uint8Array(t),this._dataView=new DataView(this._u8d.buffer),this._length=this._dataView.byteLength):this.resizeBuffer(this._allocated)}n=i.utils||(i.utils={}),e.getSystemEndian=function(){if(!e.sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,!0),e.sysEndian=256===new Int16Array(t)[0]?"littleEndian":"bigEndian"}return e.sysEndian},e.prototype.clear=function(){this._pos=0,this.length=0},Object.defineProperty(e.prototype,"byteLength",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},set:function(t){this._pos=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._length},set:function(t){this._allocated<t?this.resizeBuffer(this._allocated=Math.floor(Math.max(t,2*this._allocated))):this._allocated>t&&this.resizeBuffer(this._allocated=t),this._length=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bytesAvailable",{get:function(){return this._length-this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){var t=this._dataView.buffer;return t.byteLength==this.length?t:t.slice(0,this.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endian",{get:function(){return this.littleEndian?"littleEndian":"bigEndian"},set:function(t){this.littleEndian="littleEndian"==t},enumerable:!0,configurable:!0}),e.prototype.getString=function(){return this.rUTF(this.readUint16())},e.prototype.readCustomString=function(t){for(var e="",i=0,r=0,n=String.fromCharCode,o=this._u8d;0<t;)if((r=o[this._pos])<128)e+=n(r),this._pos++,t--;else for(i=r-128,this._pos++,t-=i;0<i;)r=o[this._pos++],e+=n(o[this._pos++]<<8|r),i--;return e},e.prototype.getFloat32Array=function(t,e){var i=t+e;return i=i>this._length?this._length:i,new Float32Array(this._dataView.buffer.slice(t,i))},e.prototype.getUint8Array=function(t,e){var i=t+e;return i=i>this._length?this._length:i,new Uint8Array(this._dataView.buffer.slice(t,i))},e.prototype.getUint16Array=function(t,e){var i=t+e;return i=i>this._length?this._length:i,new Uint16Array(this._dataView.buffer.slice(t,i))},e.prototype.getInt16Array=function(t,e){var i=t+e;return i=i>this._length?this._length:i,new Int16Array(this._dataView.buffer.slice(t,i))},e.prototype.readFloat32Array=function(t,e){var i=t+e,r=this.getFloat32Array(t,e);return this._pos=i,r},e.prototype.readUint8Array=function(t,e){var i=this.getUint8Array(t,e);return this._pos=t+e,i},e.prototype.readUint16Array=function(t,e){var i=this.getUint16Array(t,e);return this._pos=t+e,i},e.prototype.readInt16Array=function(t,e){var i=this.getInt16Array(t,e);return this._pos=t+e,i},e.prototype.getInt8=function(){if(this._pos+1>this._length)throw new Error("getInt8 error - Out of bounds");return this._dataView.getInt8(this.pos)},e.prototype.getInt16=function(){if(this._pos+2>this._length)throw new Error("getInt16 error - Out of bounds");return this._dataView.getInt16(this.pos,this.littleEndian)},e.prototype.getInt32=function(){return this._dataView.getInt32(this.pos,this.littleEndian)},e.prototype.getInt64=function(){var t=this.readInt32(),e=this.readInt32();return this._pos-=8,i.utils.Utils.combineInt64([t,e])},e.prototype.getFloat32=function(){if(this._pos+4>this._length)throw"getFloat32 error - Out of bounds";return this._dataView.getFloat32(this._pos,this.littleEndian)},e.prototype.getFloat64=function(){if(this._pos+8>this._length)throw"getFloat64 error - Out of bounds";return this._dataView.getFloat64(this._pos,this.littleEndian)},e.prototype.getUint8=function(){if(this._pos+1>this._length)throw new Error("getUint8 error - Out of bounds");return this._dataView.getUint8(this.pos)},e.prototype.getUint16=function(){if(this._pos+2>this._length)throw new Error("getUint16 error - Out of bounds");return this._dataView.getUint16(this._pos,this.littleEndian)},e.prototype.getUint32=function(){return this._dataView.getUint32(this.pos,this.littleEndian)},e.prototype.getUint64=function(){var t=this.readUint32(),e=this.readUint32();return this._pos-=8,i.utils.Utils.combineInt64([t,e])},e.prototype.readInt8=function(){var t=this.getInt8();return this._pos+=1,t},e.prototype.readInt16=function(){var t=this.getInt16();return this._pos+=2,t},e.prototype.readInt32=function(){var t=this.getInt32();return this._pos+=4,t},e.prototype.readInt64=function(){var t=this.getInt64();return this._pos+=8,t},e.prototype.readUint8=function(){var t=this.getUint8();return this._pos+=1,t},e.prototype.readUint16=function(){var t=this.getUint16();return this._pos+=2,t},e.prototype.readUint32=function(){var t=this.getUint32();return this._pos+=4,t},e.prototype.readUint64=function(){var t=this.getUint64();return this._pos+=8,t},e.prototype.readFloat32=function(){var t=this.getFloat32();return this._pos+=4,t},e.prototype.readFloat64=function(){var t=this.getFloat64();return this._pos+=8,t},e.prototype.writeInt8=function(t){return this.ensureWrite(this._pos+1),this._dataView.setInt8(this.pos,t),this._pos+=1,this},e.prototype.writeInt16=function(t){return this.ensureWrite(this._pos+2),this._dataView.setInt16(this.pos,t,this.littleEndian),this._pos+=2,this},e.prototype.writeInt32=function(t){return this.ensureWrite(this._pos+4),this._dataView.setInt32(this.pos,t,this.littleEndian),this._pos+=4,this},e.prototype.writeInt64=function(t){this.ensureWrite(this._pos+8);var e=i.utils.Utils.resoleInt64(t);return this.writeInt32(e[0]).writeInt32(e[1]),this},e.prototype.writeUint8=function(t){return this.ensureWrite(this._pos+1),this._dataView.setUint8(this.pos,t),this._pos+=1,this},e.prototype.writeByte=function(t){return this.ensureWrite(this._pos+1),this._dataView.setInt8(this._pos,t),this._pos+=1,this},e.prototype.getByte=function(){return this.getInt8()},e.prototype.readByte=function(){var t=this.getByte();return this._pos+=1,t},e.prototype.writeUint16=function(t){return this.ensureWrite(this._pos+2),this._dataView.setUint16(this.pos,t,this.littleEndian),this._pos+=2,this},e.prototype.writeUint32=function(t){return this.ensureWrite(this._pos+4),this._dataView.setUint32(this.pos,t,this.littleEndian),this._pos+=4,this},e.prototype.writeUint64=function(t){this.ensureWrite(this._pos+8);var e=i.utils.Utils.resoleInt64(t);return this.writeUint32(e[0]).writeUint32(e[1]),this},e.prototype.writeFloat32=function(t){return this.ensureWrite(this._pos+4),this._dataView.setFloat32(this.pos,t,this.littleEndian),this._pos+=4,this},e.prototype.writeFloat64=function(t){return this.ensureWrite(this._pos+8),this._dataView.setFloat64(this.pos,t,this.littleEndian),this._pos+=8,this},e.prototype.writeUTFBytes=function(t){for(var e=t+"",i=0,r=e.length;i<r;i++){var n=e.charCodeAt(i);n<=127?this.writeByte(n):n<=2047?(this.ensureWrite(this._pos+2),this._u8d.set([192|n>>6,128|63&n],this._pos),this._pos+=2):n<=65535?(this.ensureWrite(this._pos+3),this._u8d.set([224|n>>12,128|n>>6&63,128|63&n],this._pos),this._pos+=3):(this.ensureWrite(this._pos+4),this._u8d.set([240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n],this._pos),this._pos+=4)}return this},e.prototype.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var i=this.pos-e-2;if(65536<=i)throw new Error("writeUTFString byte len more than 65536");return this._dataView.setUint16(e,i,this.littleEndian),this},e.prototype.readUTFBytes=function(t){if(void 0===t&&(t=-1),0==t)return"";var e=this.bytesAvailable;if(e<t)throw"readUTFBytes error - Out of bounds";return t=0<t?t:e,this.rUTF(t)},e.prototype.readUTFString=function(){return this.readUTFBytes(this.readUint16())},e.prototype.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),!n.Utils.isNullOrUndefined(i)&&0!=i||(i=t.byteLength-e),e<0||i<0)throw new Error("writeArrayBuffer error - Out of bounds");this.ensureWrite(this._pos+i);var r=new Uint8Array(t);return this._u8d.set(r.subarray(e,e+i),this._pos),this._pos+=i,this},e.prototype.ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated<t&&(this.length=t)},e.prototype.resizeBuffer=function(e){try{var t=new Uint8Array(e);null!=this._u8d&&(this._u8d.length<=e?t.set(this._u8d):t.set(this._u8d.subarray(0,e))),this._u8d=t,this._dataView=new DataView(t.buffer)}catch(t){throw"___resizeBuffer err:"+e}},e.prototype.rUTF=function(t){for(var e="",i=this._pos+t,r=0,n=String.fromCharCode,o=this._u8d;this._pos<i;)(r=o[this._pos++])<128?0!=r&&(e+=n(r)):e+=n(r<224?(63&r)<<6|127&o[this._pos++]:r<240?(31&r)<<12|(127&o[this._pos++])<<6|127&o[this._pos++]:(15&r)<<18|(127&o[this._pos++])<<12|o[this._pos++]<<6&127|127&o[this._pos++]);return e},e.prototype.getBuffer=function(){return this._dataView.buffer},e.BIG_ENDIAN="bigEndian",e.LITTLE_ENDIAN="littleEndian",e.sysEndian=null,e.defaultLenth=0,t=e,n.Byte=t}(rigger=rigger||{}),function(r){var e,t;function i(t){}e=r.utils||(r.utils={}),i.retrievAble=function(t){return i.retrievAble(t)},i.retrievable=function(i){return function(t,e){t[i=i||t[e]]=e}},i.replaceService=function(i){return function(t,e){r.BaseApplication.replacedServiceMap[i]=t}},i.register=function(t){if(e.Utils.isNullOrEmpty(t.pluginName)){if(e.Utils.isNullOrEmpty(t.serviceName))throw new Error("not a registable service or plugin, please check, constructor:"+t);r.BaseApplication.serviceFullNameDefinitionMap[t.serviceName]=t}else r.BaseApplication.pluginFullNameDefinitionMap[t.pluginName]=t},i.makeExtendable=function(t){return void 0===t&&(t=!1),i.makeExtenasionMethod(t)},i.makeExtenasionMethod=function(s){return function(t,n,o){return t.extendMethod(n),{value:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i,r=this.executeMethodPrefixExtension(n,t);return i=s&&this.hasAnyPlugins(n)?r:o.value.apply(this,t),this.executeMethodSuffixExtension(n,t,i)}}}},i.doExtend=function(t,e,i){},i.extendableMethodMapKey="_$extendableMethodMapKey",t=i,e.DecoratorUtil=t}(rigger=rigger||{}),function(n){var t,e;function i(){}t=n.utils||(n.utils={}),i.prototype.dispose=function(){this.clear()},i.prototype.on=function(t,e,i,r){void 0===r&&(r=!1),this.handlers||(this.handlers=[]),this.handlers.push(new n.RiggerHandler(t,e,i,r))},i.prototype.off=function(t,e){if(this.handlers&&!(this.handlers.length<=0)){for(var i=[],r=0;r<this.handlers.length;r++){var n=this.handlers[r];if(n.caller===t&&n.method===e){n.recover();break}i.push(n)}for(++r;r<this.handlers.length;++r)i.push(this.handlers[r]);this.handlers=i}},i.prototype.offAll=function(t,e){if(this.handlers&&!(this.handlers.length<=0)){for(var i=[],r=this.handlers,n=r.length,o=0;o<n;++o)t!==r[o].caller||e!==r[o].method?i.push(r[o]):r[o].recover();this.handlers=i}},i.prototype.clear=function(){if(this.handlers&&!(this.handlers.length<=0)){for(var t=0;t<this.handlers.length;t++)this.handlers[t].recover();this.handlers=null}},i.prototype.execute=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this.handlers&&!(this.handlers.length<=0))for(var i=this.handlers,r=i.length,n=0;n<r;++n)i[n].runWith(t)},e=i,t.ListenerManager=e}(rigger=rigger||{}),function(t){var e,i;function f(){}e=t.utils||(t.utils={}),f.trunc=function(t){return Math.trunc?Math.trunc(t):(t=+t)-t%1||(isFinite(t)&&0!==t?t<0?-0:0:t)},f.resoleInt64=function(t){var e=Math.pow(2,32),i=t%e;return[(t-i)/e,i]},f.combineInt64=function(t){var e=Math.pow(2,32);return t[0]*e+t[1]},f.transferArrayBuffer=function(t,e){if(ArrayBuffer.transfer)return ArrayBuffer.transfer(t,e);t=Object(t);var i=new ArrayBuffer(e);if(!(i instanceof ArrayBuffer))throw new TypeError("Source and destination must be ArrayBuffer instances");return f.copyArrayBuffer(t,0,i,0,t.byteLength),i},f.copyArrayBuffer=function(t,e,i,r,n,o){if(void 0===o&&(o=!0),!(i.byteLength-r>=n))throw new Error("Dest ArrayBuffer space not enough!");for(var s=[8,4,2,1],a=n,c=Uint8Array,p=1,u=0;u<s.length;++u)if((p=s[u])<=a){switch(p){case 8:e%8==0&&r%8==0&&(c=Float64Array);break;case 4:e%4==0&&r%4==0&&(c=Float32Array);break;case 2:e%2==0&&r%2==0&&(c=Uint16Array);break;case 1:default:c=Uint8Array}for(var l=new c(t,e,f.trunc(a/p)),h=new c(i,r,l.length),g=0;g<l.length;++g)h[g]=l[g];a-=l.byteLength,e+=l.byteLength,r+=l.byteLength}},f.removeFromArray=function(t,e){var i=t.indexOf(e);return 0<=i?f.removeAtFromArray(t,i):t},f.findIndexFromArray=function(t,e,i){if(void 0===i&&(i=0),i>=t.length)return-1;for(;i<t.length;++i)if(e(t[i],i,t))return i;return-1},f.removeAtFromArray=function(t,e){return t.splice(e,1),t},f.stackTrace=function(t){void 0===t&&(t=10);var e=0,i=arguments.callee;for(console.log("***----------------------------------------** "+(e+1));i&&e<t;)i=i.arguments.callee.caller,console.log(i),e++,console.log("***---------------------------------------- ** "+(e+1))},f.random=function(t,e){var i=e-t,r=Math.random();return t+Math.round(r*i)},f.toFixed=function(t,e){if(0==e)return t.toString();var i=t.toFixed(e+1);return i.substr(0,i.length-1)},f.getValStrMax3=function(t){var e=t%10,i=Math.floor(t/10);return 100<=i?i.toString():i+"."+e},f.getQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?i[2]:null},f.isString=function(t){return"string"==typeof t},f.isArray=function(t){return t instanceof Array},f.isNullOrUndefined=function(t){return null==t},f.isNullOrEmpty=function(t){return e.Utils.isNullOrUndefined(t)||t.length<=0},f.isNumber=function(t){return!f.isNullOrUndefined(t)&&!f.isString(t)&&!isNaN(t)},f.isInteger=function(t){return 0==t%1},f.isAssetsUrlObject=function(t){return t.hasOwnProperty("url")&&t.hasOwnProperty("type")},f.getById=function(t,r){var e=f.findIndexFromArray(t,function(t,e,i){return t.id===r});return e<0?null:t[e]},f.filterCommentsInJson=function(t){return t.replace(/(?:^|\n|\r)\s*\/\*[\s\S]*?\*\/\s*(?:\r|\n|$)/g,"\n").replace(/(?:^|\n|\r)\s*\/\/.*(?:\r|\n|$)/g,"\n")},i=f,e.Utils=i}(rigger=rigger||{});var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,i,s):n(e,i))||s);return 3<o&&s&&Object.defineProperty(e,i,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rigger;!function(a){!function(t){var o,e,i=function(){this.status=o.None,this.data=null};t.ConfigInfo=i,(e=o=t.ConfigStaus||(t.ConfigStaus={}))[e.None=1]="None",e[e.Loading=2]="Loading",e[e.Ready=3]="Ready";var n,r=(n=t.AbsService,__extends(s,n),s.prototype.start=function(t,e,i){this.initApplicationConfig(t,e,i)},s.prototype.onStart=function(t,e){t.success()},s.prototype.onStop=function(t){t.success()},s.prototype.onReStart=function(t){t.success()},s.prototype.getApplicationConfig=function(t){if(this.applicationConfig)return t.runWith([this.applicationConfig]);this.applicationConfigHandlers.push(t),this.loadConfig(this.makeApplicationConfigUrl(),this,this.onApplicationConfigLoad)},s.prototype.getServiceConfig=function(t){var e=this.getServiceConfigInfo(t);return e&&e.status===o.Ready?e.data:null},s.prototype.onApplicationConfigInit=function(t){console.log("App Config Inited"),t.success()},s.prototype.onApplicationConfigLoad=function(t){a.utils.Utils.isString(t)?this.applicationConfig=JSON.parse(a.utils.Utils.filterCommentsInJson(t)):this.applicationConfig=t,this.treateApplicationConfig();for(var e=0;e<this.applicationConfigHandlers.length;++e)this.applicationConfigHandlers[e].runWith([this.applicationConfig]);this.applicationConfigHandlers=[]},s.prototype.treateApplicationConfig=function(){this.initServiceConfigs()},s.prototype.initServiceConfigs=function(){this._serviceConfigMap||(this._serviceConfigMap={});for(var t=this.applicationConfig.services,e=0;e<t.length;++e)for(var i=0;i<t[e].length;++i){var r=t[e][i],n=this.getServiceConfigInfo(r.fullName);n.data=r,n.status=o.Ready}},s.prototype.getServiceConfigInfo=function(t){var e=this._serviceConfigMap[t];return e||(e=new i,this._serviceConfigMap[t]=e),e},s.prototype.initApplicationConfig=function(t,e,i){this.getApplicationConfig(new a.RiggerHandler(this,this.doStart,[t,e,i]))},s.prototype.makeApplicationConfigUrl=function(){return"rigger/riggerConfigs/RiggerConfig.json?"+Math.random()},s.prototype.doStart=function(t,e,i,r){this.getApplication().setConfig(r),n.prototype.start.call(this,t,e,i)},s.serviceName="rigger.service.ConfigService",__decorate([a.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",String)],s.prototype,"makeApplicationConfigUrl",null),s);function s(){var t=n.call(this)||this;return t._serviceConfigMap={},t.applicationConfigHandlers=[],t}t.ConfigService=r}(a.service||(a.service={}))}(rigger=rigger||{});var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),rigger;!function(t){var e,i,r;function n(){var t=i.call(this)||this;return t.HANDLER_FIELD_TYPE_CALLER=1,t.HANDLER_FIELD_TYPE_HANDLER=2,t.HANDLER_FIELD_TYPE_INSTANCE=3,t._handlerMap={},t}e=t.service||(t.service={}),i=e.AbsService,__extends(n,i),Object.defineProperty(n,"instance",{get:function(){return n.getRunningService(n.serviceName)},enumerable:!0,configurable:!0}),n.prototype.onStart=function(t,e){t.success()},n.prototype.onStop=function(t){this._handlerMap=null,t.success()},n.prototype.onReStart=function(t){t.success()},n.prototype.addEventListener=function(t,e,i,r){void 0===e&&(e=null);try{var n=this._handlerMap[t];n?n.push({1:i,2:r,3:e}):this._handlerMap[t]=[{1:i,2:r,3:e}]}catch(t){console.log("error when add event listener:"+t),console.log(t.stack)}},n.prototype.removeEventListener=function(t,e,i,r){var n=this._handlerMap[t],o=[];if(n){for(var s=0;s<n.length;s++)e==n[s][3]&&i==n[s][1]&&r==n[s][2]||o.push(n[s]);this._handlerMap[t]=o}},n.prototype.dispatchEvent=function(e,t){void 0===t&&(t=null);for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var n=this._handlerMap[e];if(n)for(var o,s=0;s<n.length;s++)if(t==n[s][3]){o=n[s][2];try{o.apply(n[s][1],i)}catch(t){console.log("error when dispatchEvent, EventName:"+e+",Error:"+t),console.log(t.stack)}}},n.serviceName="rigger.service.EventService",r=n,e.EventService=r}(rigger=rigger||{});var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),rigger;!function(t){var e,i,r;function n(){var t=i.call(this)||this;return t.objectPool={},t.objectPool={},t}e=t.service||(t.service={}),i=e.AbsService,__extends(n,i),Object.defineProperty(n,"instance",{get:function(){return n.getRunningService(n.serviceName)},enumerable:!0,configurable:!0}),n.getPoolBySign=function(t){return n.instance.getPoolBySign(t)},n.clearBySign=function(t){n.instance.clearBySign(t)},n.recover=function(t,e){n.instance.recover(t,e)},n.getItemByClass=function(t,e){return n.instance.getItemByClass(t,e)},n.getItemByCreateFun=function(t,e){return n.instance.getItemByCreateFun(t,e)},n.getItem=function(t){return n.instance.getItem(t)},n.prototype.getPoolBySign=function(t){var e=this.objectPool[t];return e||(this.objectPool[t]=e=[]),e},n.prototype.clearBySign=function(t){delete this.objectPool[t]},n.prototype.recover=function(t,e){this.getPoolBySign(t).push(e)},n.prototype.getItemByClass=function(t,e){var i=this.getItem(t);return i||new e},n.prototype.getItemByCreateFun=function(t,e){var i=this.getItem(t);return i||e()},n.prototype.getItem=function(t){var e=this.getPoolBySign(t);return e.length<=0?null:e.pop()},n.prototype.onStart=function(t,e){this.objectPool={},t.success()},n.prototype.onStop=function(t){this.objectPool=null,t.success()},n.prototype.onReStart=function(t){this.objectPool={},t.success()},n.serviceName="rigger.service.PoolService",r=n,e.PoolService=r}(rigger=rigger||{});var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),rigger,rigger,rigger,rigger,rigger,rigger;!function(t){var e,i,r;function n(){return i.call(this)||this}e=t.service||(t.service={}),i=e.AbsService,__extends(n,i),n.prototype.onStart=function(t,e){t.success()},n.prototype.onStop=function(t){t.success()},n.prototype.onReStart=function(t){t.success()},n.serviceName="rigger.service.KernelService",r=n,e.KernelService=r}(rigger=rigger||{}),function(r){var t=(Object.defineProperty(e.prototype,"nowState",{get:function(){return this.mNowStateName},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){for(var t in this.paramsMap)delete this.paramsMap[t];this.stateMap=null,this.paramsMap=null,this.triggerMap=null},e.prototype.start=function(){this.checkNowState()},e.prototype.checkNowState=function(){var t=this.stateMap[this.mNowStateName];if(!t)throw new Error("can not find state in checkNowState:"+this.mNowStateName);var e=t.checkAllTransitions(this);e&&this.transitToState(t,this.getState(e))},e.prototype.addState=function(t,e){void 0===e&&(e=!1);var i=this.stateMap[t];return i=i||new r.FSMState(t),this.stateMap[t]=i,!e&&this.mNowStateName||(this.mNowStateName=t),i},e.prototype.getState=function(t){return this.stateMap[t]},e.prototype.getValue=function(t){return this.paramsMap[t]},e.prototype.setValue=function(t,e,i){void 0===i&&(i=!1),i&&(this.triggerMap[t]={oldValue:this.paramsMap[t]}),this.paramsMap[t]=e,this.onParamsChange(t)},e.prototype.onParamsChange=function(t){var e=this.stateMap[this.mNowStateName];if(!e)throw new Error("can not find state:"+this.mNowStateName);var i=e.onParamsChange(this,t);r.utils.Utils.isNullOrUndefined(i)||this.transitToState(e,this.getState(i))},e.prototype.transitToState=function(t,e){if(!e)throw new Error("trying to transit to a invalid new state");for(var i,r,n=t.stateName,o=e.stateName,s=t.getTransition(o).conditions,a=s.length,c=0;c<a;c++)i=s[c].paramsName,(r=this.triggerMap[i])&&(delete this.triggerMap[i],this.setValue(i,r.oldValue));t.executeLeaveAction(o),this.mNowStateName=o,this.getState(o).executeEnterAction(n),t.stateName!==e.stateName&&this.checkNowState()},e);function e(){this.mNowStateName=null,this.stateMap={},this.paramsMap={},this.triggerMap={}}r.FSM=t}(rigger=rigger||{}),function(c){var t=(e.prototype.dispose=function(){this.mStateName=null,this.transitionsMap=null,this.mParamsStateRelationMap=null,this.enterActionManager.dispose(),this.leaveActionManager.dispose()},e.prototype.addEnterAction=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return this.enterActionManager||(this.enterActionManager=new c.utils.ListenerManager),this.enterActionManager.on(t,e,i),this},e.prototype.addLeaveAction=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return this.leaveActionManager||(this.leaveActionManager=new c.utils.ListenerManager),this.leaveActionManager.on(t,e,i),this},e.prototype.executeEnterAction=function(t){this.enterActionManager&&this.enterActionManager.execute(t,this.stateName)},e.prototype.executeLeaveAction=function(t){this.leaveActionManager&&this.leaveActionManager.execute(this.stateName,t)},Object.defineProperty(e.prototype,"paramsStateRelationMap",{get:function(){return this.mParamsStateRelationMap},enumerable:!0,configurable:!0}),e.prototype.addTransition=function(t,e,i,r){for(var n=[],o=4;o<arguments.length;o++)n[o-4]=arguments[o];if(c.utils.Utils.isNullOrUndefined(t))return this;if(!c.utils.Utils.isNullOrUndefined(e)){var s=this.mParamsStateRelationMap[e];(s=s||(this.mParamsStateRelationMap[e]=[])).indexOf(t)<0&&s.push(t)}var a=this.getTransition(t);return(a=a||this.setTransition(t,new c.FSMTransition(t))).addCondition.apply(a,[e,i,r].concat(n)),this},e.prototype.onParamsChange=function(t,e){var i=this.mParamsStateRelationMap[e];if(i&&!(i.length<=0)){for(var r=0;r<i.length;r++){var n=i[r],o=this.transitionsMap[n];if(o&&o.check(t))return n}return null}},e.prototype.checkAllTransitions=function(t){for(var e in this.transitionsMap){var i=this.transitionsMap[e];if(i&&i.check(t))return e}return null},e.prototype.getTransition=function(t){return this.transitionsMap[t]},e.prototype.setTransition=function(t,e){return this.transitionsMap[t]=e},Object.defineProperty(e.prototype,"stateName",{get:function(){return this.mStateName},enumerable:!0,configurable:!0}),e);function e(t){this.mParamsStateRelationMap={},this.mStateName=t,this.transitionsMap={},this.mParamsStateRelationMap={}}c.FSMState=t}(rigger=rigger||{}),function(s){var t=(e.prototype.dispose=function(){this.toStateName=null;for(var t=0;t<this.mConditions.length;t++)this.mConditions[t].dispose()},Object.defineProperty(e.prototype,"conditions",{get:function(){return this.mConditions},enumerable:!0,configurable:!0}),e.prototype.addCondition=function(t,e,i){for(var r=[],n=3;n<arguments.length;n++)r[n-3]=arguments[n];if(i&&!s.utils.Utils.isNullOrUndefined(t)){var o=new s.FSMTransitionCondition(t,s.RiggerHandler.create(e,i,r,!1));this.mConditions.push(o)}},e.prototype.check=function(t){for(var e=0;e<this.mConditions.length;e++)if(!this.mConditions[e].check(t))return!1;return!0},e);function e(t){this.mConditions=[],this.toStateName=t,this.mConditions=[]}s.FSMTransition=t}(rigger=rigger||{}),function(t){var e=(i.prototype.dispose=function(){this.paramsName=null,this.checkHandler&&this.checkHandler.recover()},i.prototype.check=function(t){return!!this.checkHandler&&this.checkHandler.runWith([t.getValue(this.paramsName),t,this.paramsName])},i);function i(t,e){this.paramsName=t,this.checkHandler=e}t.FSMTransitionCondition=e}(rigger=rigger||{}),function(t){var e=(i.equal=function(e){return function(t){return e===t}},i.notEqual=function(e){return function(t){return e!==t}},i.less=function(e){return function(t){return t<e}},i.lessEqual=function(e){return function(t){return t<=e}},i.greater=function(e){return function(t){return e<t}},i.greaterEqual=function(e){return function(t){return e<=t}},i);function i(){}t.FSMUtils=e}(rigger=rigger||{});
var __extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__decorate=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(c=(r<3?n(c):3<r?n(e,o,c):n(e,o))||c);return 3<r&&c&&Object.defineProperty(e,o,c),c},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},CCBasedConfigService=function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.onStart=function(t,e){n.prototype.onStart.call(this,t,e)},t.prototype.loadConfig=function(t,e,o,i){var n=rigger.BaseApplication.instance.getConfig();n?o.apply(e,[n]):cc.error("please attach the app config to the application component")},t.prototype.initApplicationConfig=function(t,e,o){if(o){var i=o.applicationConfig;i&&this.onApplicationConfigLoad(i)}n.prototype.initApplicationConfig.call(this,t,e,o)},t.prototype.makeApplicationConfigUrl=function(){return""},t.serviceName="CCBasedConfigService",__decorate([rigger.utils.DecoratorUtil.replaceService(rigger.service.ConfigService.serviceName),__metadata("design:type",String)],t,"serviceName",void 0),t}(rigger.service.ConfigService);
var rigger,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate=this&&this.__decorate||function(t,e,r,n){var a,o=arguments.length,i=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;0<=s;s--)(a=t[s])&&(i=(o<3?a(i):3<o?a(e,r,i):a(e,r))||i);return 3<o&&i&&Object.defineProperty(e,r,i),i},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(d){var t,e,r;function p(){return e.call(this)||this}t=d.service||(d.service={}),e=t.AbsService,__extends(p,e),Object.defineProperty(p,"instance",{get:function(){return p.getRunningService(p.serviceName)},enumerable:!0,configurable:!0}),p.isAssetsUrlObject=function(t){return t.hasOwnProperty("url")&&t.hasOwnProperty("type")},p.prototype.getAssets=function(t,e,r,n,a,o){void 0===o&&(o=!0);var i,s=!1;if(d.utils.Utils.isArray(t)){s=!0,i=[];for(var c=void 0,l=0;l<t.length;++l){var u;if(c=t[l],!p.isAssetsUrlObject(c))return i=null,console.error("assets url is not correct"),null;if(!(u=this.getCache(c.url))){i=null;break}i.push(u)}}else{if(!d.utils.Utils.isString(t)&&!p.isAssetsUrlObject(t))return console.error("assets url is not correct"),null;i=this.getCache(t)}return i||(this.load(s?t:[t],e,r,n,a,o),null)},p.prototype.initVersion=function(t,e){t.run()},p.prototype.getCache=function(t){return null},p.prototype.load=function(t,e,r,n,a,o,i){return void 0===o&&(o=!0),null},p.prototype.clear=function(t){},p.prototype.clearUnloaded=function(){},p.prototype.cache=function(t,e){},p.prototype.cancelLoadByUrl=function(t){},p.prototype.onStart=function(t,e){t.success()},p.prototype.onStop=function(t){t.success()},p.prototype.onReStart=function(t){t.success()},p.prototype.cancelLoad=function(t){if(d.utils.Utils.isString(t))this.cancelLoadByUrl(t);else if(d.utils.Utils.isArray(t))for(var e=0;e<t.length;++e)this.cancelLoad(t[e]);else p.isAssetsUrlObject(t)&&this.cancelLoadByUrl(t.url)},p.prototype.unload=function(t,e){if(void 0===e&&(e=!0),t)switch(t.constructor){case Array:for(var r=t.length,n=0;n<r;++n)this.unload(t[n],e);break;default:this.unloadSingle(t,e)}},p.prototype._onError=function(t){console.log("stackstrace:"+t.stackstrace),console.log("error:"+t)},p.prototype.unloadSingle=function(t,e){if(void 0===e&&(e=!0),t)if(d.utils.Utils.isString(t)){if(!this.getCache(t))return;console.log("unload url:"+t),this.clear(t)}else{if(!this.getCache(t.url))return;console.log("unload url:"+t.url),this.clear(t.url)}},p.serviceName="AssetsService",__decorate([d.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[d.RiggerHandler,d.RiggerHandler]),__metadata("design:returntype",void 0)],p.prototype,"initVersion",null),__decorate([d.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],p.prototype,"getCache",null),__decorate([d.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,d.RiggerHandler,d.RiggerHandler,Object,Number,Boolean,Object]),__metadata("design:returntype",Object)],p.prototype,"load",null),__decorate([d.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",void 0)],p.prototype,"clear",null),__decorate([d.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],p.prototype,"clearUnloaded",null),__decorate([d.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[String,Object]),__metadata("design:returntype",void 0)],p.prototype,"cache",null),__decorate([d.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[String]),__metadata("design:returntype",void 0)],p.prototype,"cancelLoadByUrl",null),r=p,t.AssetsService=r}(rigger=rigger||{});
var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,a){var n,i=arguments.length,o=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,a);else for(var c=e.length-1;0<=c;c--)(n=e[c])&&(o=(i<3?n(o):3<i?n(t,r,o):n(t,r))||o);return 3<i&&o&&Object.defineProperty(t,r,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(o){!function(e){var t=(Object.defineProperty(r.prototype,"service",{get:function(){return this.mService||(this.mService=n.getRunningService(n.serviceName)),this.mService},enumerable:!0,configurable:!0}),r.prototype.package=function(a){return this.packageMap||(this.packageMap={}),function(e,t,r){this.registerPackage(a,e[t]())}.bind(this)},r.prototype.group=function(a,n){return this.groupMap||(this.groupMap={}),this.packageMap||(this.packageMap={}),function(e,t,r){this.registerPackage(n,e[t]()),this.registerGroup(a,n)}.bind(this)},r.prototype.registerPackage=function(e,r){function t(t){-1==o.utils.Utils.findIndexFromArray(a,function(e){return e.url==r[t].url})&&a.push(r[t])}this.packageMap||(this.packageMap={}),r instanceof Array||(r=[r]);for(var a=this.packageMap[e]||[],n=0;n<r.length;++n)t(n);this.packageMap[e]=a},r.prototype.registerGroup=function(e,t){this.groupMap||(this.groupMap={});var r=this.groupMap[e]||[];r.indexOf(t)<0&&r.push(t),this.groupMap[e]=r},r.prototype.loadPackage=function(e,t,r){var a=this.getUrlsByPackage(e)||this.service.makePackageUrl(e);return!!o.service.AssetsService.instance.getAssets(a,new o.RiggerHandler(this,this.onPackageLoad,[e,t]),r)},r.prototype.clearPackage=function(e){(this.getUrlsByPackage(e)||this.service.makePackageUrl(e)).forEach(function(e){return o.service.AssetsService.instance.clear(e.url)})},r.prototype.loadPackageByGroup=function(e,t,r){var a=this.getPackagesByGroup(e);if(a&&0<a.length)return this.loadPackage(a,t,r);throw new Error("invalid group name:"+e)},r.prototype.clearPackageByGroup=function(e){var t=this.getPackagesByGroup(e);if(t&&0<t.length)return this.clearPackage(t)},r.prototype.getUrlsByPackage=function(e){if(o.utils.Utils.isArray(e)||(e=[e]),!this.packageMap)return null;for(var t=null,r=0;r<e.length;++r){var a=this.packageMap[e[r]];a&&(t=(t=t||[]).concat(a))}return t},r.prototype.getPackagesByGroup=function(e){if(!this.groupMap)return this.service.getPackagesByGroupConfig(e);var t=this.groupMap[e];return t||this.service.getPackagesByGroupConfig(e)},r.prototype.onPackageLoad=function(e,t,r,a){r&&this.service.initPackage(e),t&&t.runWith([r,a])},r);function r(){this.mService=null}e.AssetsPackageManager=t;var a,n=(a=e.AbsService,__extends(i,a),Object.defineProperty(i,"instance",{get:function(){return i.getRunningService(i.serviceName)},enumerable:!0,configurable:!0}),i.createManager=function(){return new t},i.prototype.initPackage=function(e){},i.prototype.makePackageUrl=function(e){return null},i.prototype.onStart=function(e,t){e.success()},i.prototype.onStop=function(e){e.success()},i.prototype.onReStart=function(e){e.success()},i.prototype.getPackagesByGroupConfig=function(e){return this.getConfig().packageGroups[e]},i.serviceName="rigger.service.AssetsPackageService",__decorate([o.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],i.prototype,"initPackage",null),__decorate([o.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Array)],i.prototype,"makePackageUrl",null),i);function i(){return a.call(this)||this}e.AssetsPackageService=n}(o.service||(o.service={}))}(rigger=rigger||{});var rigger;__extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();!function(e){var t,r,a;function n(){var e=r.call(this)||this;return e.plugins=[{fullName:"rigger.service.FairyGUIPackagePlugin",src:"",dest:"",version:""},{fullName:"rigger.service.PackageUrlPlugin",src:"",dest:"",version:""}],e.packageGroups={1:["loading"],2:["mainScene","gmCmd","serverList"]},e}t=e.config||(e.config={}),r=t.ServiceConfig,__extends(n,r),a=n,t.AssetsPackageServiceConfig=a}(rigger=rigger||{});
!function(e){(e.service||(e.service={})).NetworkChannelSpec=function(){}}(rigger=rigger||{}),function(e){var t,n;(n=(t=e.service||(e.service={})).NetworkChannelType||(t.NetworkChannelType={}))[n.HTTP=1]="HTTP",n[n.XML_HTTP_REQUEST=2]="XML_HTTP_REQUEST",n[n.WEB_SOCKET=3]="WEB_SOCKET",n[n.SOCKET=4]="SOCKET"}(rigger=rigger||{});var rigger,__extends=this&&this.__extends||function(){var a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),__decorate=this&&this.__decorate||function(e,t,n,a){var o,i=arguments.length,r=i<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,a);else for(var s=e.length-1;0<=s;s--)(o=e[s])&&(r=(i<3?o(r):3<i?o(t,n,r):o(t,n))||r);return 3<i&&r&&Object.defineProperty(t,n,r),r},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(r){var e,t,n;function a(){var e=t.call(this)||this;return e.blocked=!1,e.blockedMessages=[],e.channelHandlersMap={},e.channelMap={},e._inited=!1,e}e=r.service||(r.service={}),t=e.AbsService,__extends(a,t),Object.defineProperty(a,"instance",{get:function(){return a.getRunningService(a.serviceName)},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){for(var e in this._inited=!1,this.channelMap)this.channelMap[e].close();for(var t in this.channelHandlersMap)this.channelHandlersMap[t].dispose();this.channelMap={},this.channelHandlersMap={}},a.prototype.connect=function(e,t,n,a,o){if(void 0===a&&(a=1e3),void 0===o&&(o=""),this._inited){var i=this.channelMap[e];i&&(i.isEngaged&&!i.isEngaged()||i.close(a,o),i.connect(t,n),i.onMessage(this,this.onReceiveChannelMessage,[e],!1))}},a.prototype.close=function(e,t,n){if(void 0===t&&(t=1e3),void 0===n&&(n=""),this._inited){var a=this.channelMap[e];r.utils.Utils.isNullOrUndefined(a)||(a.offMessage(this,this.onReceiveChannelMessage),a.close(t,n))}},a.prototype.destroyChannel=function(e,t,n){void 0===t&&(t=1e3),void 0===n&&(n="");var a=this.messageListenerMap[e];a&&(a.clear(),a.dispose(),delete this.messageListenerMap[e]),(a=this.channelHandlersMap[e])&&(a.clear(),a.dispose(),delete this.channelHandlersMap[e]),this.close(e,t,n),delete this.channelMap[e]},a.prototype.send=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var a={channelName:e,innerData:t,outterData:null};a=this.assembleNetworkPackage(this.encode(a)),this.channelMap[e].send(a.outterData)},a.prototype.pause=function(){this.blocked=!0},a.prototype.resume=function(){this.blocked=!1;for(var e=0;e<this.blockedMessages.length;++e)this.dispatchPackage(this.blockedMessages[e].channelName,this.blockedMessages[e].package);this.blockedMessages=[]},a.prototype.onConnect=function(e,t,n,a,o){void 0===a&&(a=null),void 0===o&&(o=!1);var i=this.channelMap[e];r.utils.Utils.isNullOrUndefined(i)||i.onConnect(t,n,a,o)},a.prototype.offConnect=function(e,t,n){var a=this.channelMap[e];r.utils.Utils.isNullOrUndefined(a)||a.offConnect(t,n)},a.prototype.onError=function(e,t,n,a,o){void 0===a&&(a=null),void 0===o&&(o=!1);var i=this.channelMap[e];r.utils.Utils.isNullOrUndefined(i)||i.onError(t,n,a,o)},a.prototype.offError=function(e,t,n){var a=this.channelMap[e];r.utils.Utils.isNullOrUndefined(a)||a.offError(t,n)},a.prototype.onClose=function(e,t,n,a,o){void 0===a&&(a=null),void 0===o&&(o=!1);var i=this.channelMap[e];r.utils.Utils.isNullOrUndefined(i)||i.onClose(t,n,a,o)},a.prototype.offClose=function(e,t,n){var a=this.channelMap[e];r.utils.Utils.isNullOrUndefined(a)||a.offClose(t,n)},a.prototype.onChannelMessage=function(e,t,n,a,o){void 0===a&&(a=null),void 0===o&&(o=!1),this.channelHandlersMap[e].on(t,n,a,o)},a.prototype.offChannelMessage=function(e,t,n){this.channelHandlersMap[e].off(t,n)},a.prototype.encode=function(e){return e.outterData=e.innerData,e},a.prototype.decode=function(e){return e},a.prototype.makeSureChanelInit=function(e){var t=this;if(void 0===e&&(e=[]),!(e.length<=0)){this.channelMap||(this.channelMap={}),this.channelHandlersMap||(this.channelHandlersMap={});var n=e.filter(function(e){return!t.channelMap[e.channelName]});if(!(n.length<=0))for(var a,o=this.createChannels(n),i=0;i<o.length;++i)a=o[i].getChannelName(),this.channelMap[a]=o[i],this.channelHandlersMap[a]=new r.utils.ListenerManager}},a.prototype.createChannels=function(e){return[]},a.prototype.assembleNetworkPackage=function(e){return e},a.prototype.unAssembleNetworkPackage=function(e){return e},a.prototype.route=function(e,t){},a.prototype.onReceiveChannelMessage=function(e,t){var n=this.decode(this.unAssembleNetworkPackage({channelName:e,innerData:null,outterData:t}));this.blocked?this.blockPackage(e,n):this.dispatchPackage(e,n)},a.prototype.dispatchPackage=function(e,t){this.route(e,t);var n=this.channelHandlersMap[e];n&&n.execute(e,t.innerData)},a.prototype.blockPackage=function(e,t){this.blockedMessages.push({channelName:e,package:t})},a.prototype.onStart=function(e,t){this.init(),e.success()},a.prototype.onStop=function(e){for(var t in this.channelMap)this.channelMap[t].close();for(var n in this.channelHandlersMap)this.channelHandlersMap[n].clear();this.channelMap={},this.channelHandlersMap={},e.success()},a.prototype.onReStart=function(e){e.success()},a.prototype.init=function(){this.initChannels(),this._inited=!0},a.prototype.initChannels=function(){var e=this.getConfig();this.makeSureChanelInit(e.channels)},a.serviceName="NetworkService",__decorate([r.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Object)],a.prototype,"encode",null),__decorate([r.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Object)],a.prototype,"decode",null),__decorate([r.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Array]),__metadata("design:returntype",Array)],a.prototype,"createChannels",null),__decorate([r.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Object)],a.prototype,"assembleNetworkPackage",null),__decorate([r.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",Object)],a.prototype,"unAssembleNetworkPackage",null),__decorate([r.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Object]),__metadata("design:returntype",void 0)],a.prototype,"route",null),n=a,e.NetworkService=n}(rigger=rigger||{});
var rigger,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;0<=c;c--)(a=e[c])&&(i=(o<3?a(i):3<o?a(t,r,i):a(t,r))||i);return 3<o&&i&&Object.defineProperty(t,r,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){var t,r,n;function a(){var e=r.call(this)||this;return e.savedServerTime=0,e.lastSettingServerTime=0,e}t=e.service||(e.service={}),r=t.AbsService,__extends(a,r),Object.defineProperty(a,"instance",{get:function(){return a.getRunningService(a.serviceName)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"serverTime",{get:function(){return this.getServerTime()},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"localTime",{get:function(){return this.getLocalTime()},enumerable:!0,configurable:!0}),a.prototype.loop=function(e,t,r,n,a,o){},a.prototype.once=function(e,t,r,n,a){},a.prototype.clear=function(e,t){},a.prototype.clearAll=function(e){},a.prototype.getServerTime=function(){return this.savedServerTime+this.getLocalTime()-this.lastSettingServerTime},a.prototype.getLocalTime=function(){return 0},a.prototype.setServerTime=function(e){this.savedServerTime=e,this.lastSettingServerTime=this.getLocalTime()},a.prototype.onStart=function(e,t){e.success()},a.prototype.onStop=function(e){e.success()},a.prototype.onReStart=function(e){e.success()},a.serviceName="rigger.service.TimeService",__decorate([e.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Object,Function,Array,Boolean,Boolean]),__metadata("design:returntype",void 0)],a.prototype,"loop",null),__decorate([e.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Number,Object,Function,Array,Boolean]),__metadata("design:returntype",void 0)],a.prototype,"once",null),__decorate([e.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object,Function]),__metadata("design:returntype",void 0)],a.prototype,"clear",null),__decorate([e.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],a.prototype,"clearAll",null),__decorate([e.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Number)],a.prototype,"getServerTime",null),__decorate([e.utils.DecoratorUtil.makeExtendable(),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Number)],a.prototype,"getLocalTime",null),n=a,t.TimeService=n}(rigger=rigger||{});
var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__decorate=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(r<3?o(a):3<r?o(e,i,a):o(e,i))||a);return 3<r&&a&&Object.defineProperty(e,i,a),a},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(o){var e,i,n,t;function r(t,e){this.timeoutToleance=3,this.duration=1e4,this.unClearedPingTimes=0,this.timeoutHandlers=[],this.channelName=t,this.service=e}function a(){var t=n.call(this)||this;return t.mDruation=1e4,t.unClearedPingTimes=0,t.heartBeatsMap={},t.mTimeoutToleance=3,t}e=o.service||(o.service={}),r.prototype.start=function(){this.startTimer(),this.service.receivePong(this.channelName),this.ping()},r.prototype.stop=function(){e.TimeService.instance.clearAll(this),this.service.cancelReceivePong(this.channelName);for(var t=0;t<this.timeoutHandlers.length;++t)this.timeoutHandlers[t].dispose();this.timeoutHandlers=[],this.service=null},r.prototype.onTimeOut=function(t,e,i,n){void 0===n&&(n=!1),this.timeoutHandlers.push(new o.RiggerHandler(t,e,i,n))},r.prototype.offTimeOut=function(t,e){for(var i=[],n=0;n<this.timeoutHandlers.length;++n)t!==this.timeoutHandlers[n].caller&&e!==this.timeoutHandlers[n].method&&i.push(this.timeoutHandlers[n]);this.timeoutHandlers=i},r.prototype.startTimer=function(){e.TimeService.instance.loop(this.duration,this,this.ping)},r.prototype.ping=function(){if(this.timeoutToleance<=this.unClearedPingTimes)return this.timeOut();++this.unClearedPingTimes,this.service.ping(this.channelName)},r.prototype.timeOut=function(){for(var t=0;t<this.timeoutHandlers.length;++t)this.timeoutHandlers[t].run()},i=r,n=e.AbsService,__extends(a,n),Object.defineProperty(a,"instance",{get:function(){return a.getRunningService(a.serviceName)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){return this.mDruation},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeoutToleance",{get:function(){return this.mTimeoutToleance},enumerable:!0,configurable:!0}),a.prototype.startHeartBeat=function(t){var e=this.getHeartBeat(t);e||((e=new i(t,this)).duration=this.mDruation,e.timeoutToleance=this.mTimeoutToleance,(this.heartBeatsMap[t]=e).start())},a.prototype.stopHeartBeat=function(t){var e=this.getHeartBeat(t);e&&(e.stop(),delete this.heartBeatsMap[t])},a.prototype.stopAllHeartBeat=function(){for(var t in this.heartBeatsMap)this.heartBeatsMap[t].stop();this.heartBeatsMap={}},a.prototype.ping=function(t){},a.prototype.receivePong=function(t){},a.prototype.cancelReceivePong=function(t){},a.prototype.pong=function(t){this.unClearedPingTimes=0},a.prototype.onTimeOut=function(t,e,i,n,o){void 0===o&&(o=!1);var r=this.getHeartBeat(t);r&&r.onTimeOut(e,i,n,o)},a.prototype.offTimeOut=function(t,e,i){var n=this.getHeartBeat(t);n&&n.offTimeOut(e,i)},a.prototype.onStart=function(t,e){this.initConfig(),t.success()},a.prototype.onStop=function(t){for(var e in this.heartBeatsMap)this.heartBeatsMap[e].stop();this.heartBeatsMap={},t.success()},a.prototype.onReStart=function(t){this.initConfig(),t.success()},a.prototype.initConfig=function(){var t=this.getConfig();this.mDruation=t.duration,this.mTimeoutToleance=t.timeoutNum},a.prototype.getHeartBeat=function(t){return this.heartBeatsMap?this.heartBeatsMap[t]:null},a.serviceName="HeartBeatService",__decorate([o.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],a.prototype,"ping",null),__decorate([o.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],a.prototype,"receivePong",null),__decorate([o.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],a.prototype,"cancelReceivePong",null),t=a,e.HeartBeatService=t}(rigger=rigger||{});var rigger;__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}();!function(t){var e,i,n;function o(){return i.call(this)||this}e=t.service||(t.service={}),i=t.config.ServiceConfig,__extends(o,i),n=o,e.HeartBeatServiceConfig=n}(rigger=rigger||{});
var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),__decorate=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var c=t.length-1;0<=c;c--)(o=t[c])&&(i=(a<3?o(i):3<a?o(e,n,i):o(e,n))||i);return 3<a&&i&&Object.defineProperty(e,n,i),i},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},MainLogicService=function(t){function r(){return t.call(this)||this}return __extends(r,t),Object.defineProperty(r,"instance",{get:function(){return rigger.BaseApplication.instance.getRunningService(r.serviceName)},enumerable:!0,configurable:!0}),r.getEntranceClassById=function(t){return void 0===t&&(t=""),r.entranceClassMap[t]},r.makeEntrance=function(e){return void 0===e&&(e=""),function(t){if(r.entranceClassMap[e])throw new Error("Made Entrance Duplicatly, id:"+e);rigger.utils.Utils.isNullOrUndefined(r.defaultId)&&(r.defaultId=e),r.entranceClassMap[e]=t}},r.getEntranceById=function(t){return r.mEntranceMap[t]},r.setEntranceById=function(t,e){this.mEntranceMap[t]=e},r.prototype.launch=function(t){if(r.getEntranceById(t))throw new Error("A context has been launched:"+t);var e=r.entranceClassMap[t];if(!e)throw new Error("no entrance class registered:"+t);var n=new e(t);return r.setEntranceById(t,n),n},r.prototype.exit=function(t){r.setEntranceById(t,void 0)},r.prototype.onStart=function(t,e){t.success(),this.startEngine(e),this.startContext()},r.prototype.onStop=function(t){},r.prototype.onStartEngine=function(t,e){},r.prototype.onReStart=function(t){},r.prototype.startEngine=function(t){this.onStartEngine(this.getConfig(),t)},r.prototype.startContext=function(){rigger.utils.Utils.isNullOrUndefined(r.defaultId)||this.launch(r.defaultId)},r.serviceName="MainLogicService",r.ENTRANCE_FLAG_START_ARGS="startArgs",r.ENTRANCE_FLAG_IMPORT="import",r.entranceClassMap={},r.defaultId=null,r.mEntranceMap={},__decorate([rigger.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[MainLogicServiceConfig,Object]),__metadata("design:returntype",void 0)],r.prototype,"onStartEngine",null),__decorate([rigger.utils.DecoratorUtil.makeExtendable(!0),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],r.prototype,"startContext",null),r}(rigger.service.AbsService),MainLogicServiceConfig=(__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),function(e){function t(){var t=e.call(this)||this;return t.defaultFont="",t.width=1136,t.height=640,t.backgroundColor="#ffffff",t.resVersionAvailable=!1,t.renderMode=2,t.webGL=!0,t.frameRate="slow",t}return __extends(t,e),t}(rigger.config.ServiceConfig));
var ccPlugins,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();!function(t){var e,r=(e=rigger.AbsServicePlugin,__extends(n,e),n.prototype.initVersion=function(t,e){t&&t.success()},n.prototype.getCache=function(t){return rigger.service.AssetsService.isAssetsUrlObject(t)?cc.loader.getRes(t.url,t.type):cc.loader.getRes(t)},n.prototype.load=function(t,r,n,e,o,c,s){if(!t)return r&&r.run();if(t.length<=0)return r&&r.run();var i=this;rigger.utils.Utils.isString(t[0])?cc.loader.loadResArray(t,e,function(t,e,r){return i.onProgress(t,e,r,n)},function(t,e){return i.onComplete(t,e,r)}):(t=(t=t).map(function(t,e,r){return t.url}),cc.loader.loadResArray(t,cc.Asset,function(t,e,r){return i.onProgress(t,e,r,n)},function(t,e){i.onComplete(t,e,r)}))},n.prototype.clear=function(t){rigger.utils.Utils.isArray(t)?t.forEach(function(t){return cc.loader.releaseRes(t)}):cc.loader.releaseRes(t)},n.prototype.clearUnloaded=function(){},n.prototype.cache=function(t,e){},n.prototype.cancelLoadByUrl=function(t){},n.prototype.onStart=function(t,e){t.success()},n.prototype.onStop=function(t){t.success()},n.prototype.onRestart=function(t){t.success()},n.prototype.onProgress=function(t,e,r,n){var o=t/e;n&&n.runWith([o])},n.prototype.onComplete=function(t,e,r){t?r&&r.runWith([!1,t]):r&&r.runWith([e])},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.CCAssetsPlugin=r}(ccPlugins=ccPlugins||{});
var ccPlugins,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(t){var n,o=(n=rigger.AbsServicePlugin,__extends(e,n),e.prototype.getLocalTime=function(){return(new Date).getTime()},e.prototype.onStart=function(t,n){t.success()},e.prototype.onStop=function(t){t.success()},e.prototype.onRestart=function(t){t.success()},e);function e(){return n.call(this)||this}t.CCLocalTimePlugin=o}(ccPlugins=ccPlugins||{});
var __extends=this&&this.__extends||function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(s){var e,t=(e=rigger.AbsServicePlugin,__extends(n,e),n.prototype.onStart=function(e,t){e.success()},n.prototype.onStop=function(e){e.success()},n.prototype.onRestart=function(e){e.success()},n.prototype.createChannels=function(e){for(var t=[],n=0;n<e.length;++n)switch(e[n].channelType){case rigger.service.NetworkChannelType.WEB_SOCKET:t.push(new s.CCWebsocketNetworkChannel(e[n]))}return t},n);function n(){return rigger.service.NetworkService,e.call(this)||this}s.CCNetworkChannelPlugin=t}(ccPlugins=ccPlugins||{});var ccPlugins;__extends=this&&this.__extends||function(){var s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(e){var t,n=(t=rigger.service.NetworkChannelSpec,__extends(s,t),s);function s(){return null!==t&&t.apply(this,arguments)||this}e.CCNetworkChannelSpec=n}(ccPlugins=ccPlugins||{}),function(e){var t=(n.prototype.getChannelName=function(){return this.channelName},n.prototype.connect=function(e,t){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED)throw new Error("A Channel is avtivated, and not closed, now state:"+this.socket.readyState);var n=rigger.utils.Utils.isNullOrUndefined(t)?e:e+":"+t,s=null;cc.sys.isNative&&this.cacertPath&&(s=cc.url.raw(this.cacertPath),cc.loader.md5Pipe&&(s=cc.loader.md5Pipe.transformURL(s))),this.socket=new WebSocket(n,[],s),this.socket.binaryType="arraybuffer",this.listenSocket()},n.prototype.isEngaged=function(){return!!this.socket&&this.socket.readyState!==WebSocket.CLOSED},n.prototype.send=function(e){if(!this.socket||this.socket.readyState!==WebSocket.OPEN)throw new Error("Socket is not ready to send, channel name:"+this.channelName);e instanceof rigger.utils.Byte?this.socket.send(e.buffer):this.socket.send(e)},n.prototype.close=function(e,t){this.socket&&this.socket.readyState!==WebSocket.CLOSED&&this.socket.readyState!==WebSocket.CLOSING&&this.socket.close(e,t)},n.prototype.onConnect=function(e,t,n,s){this.openListener||(this.openListener=new rigger.utils.ListenerManager),this.openListener.on(e,t,n,s)},n.prototype.offConnect=function(e,t){this.openListener&&this.openListener.off(e,t)},n.prototype.onError=function(e,t,n,s){this.errorListener||(this.errorListener=new rigger.utils.ListenerManager),this.errorListener.on(e,t,n,s)},n.prototype.offError=function(e,t){this.errorListener&&this.errorListener.off(e,t)},n.prototype.onClose=function(e,t,n,s){this.closeListener||(this.closeListener=new rigger.utils.ListenerManager),this.closeListener.on(e,t,n,s)},n.prototype.offClose=function(e,t){this.closeListener&&this.closeListener.off(e,t)},n.prototype.onMessage=function(e,t,n,s){this.messageListener||(this.messageListener=new rigger.utils.ListenerManager),this.messageListener.on(e,t,n,s)},n.prototype.offMessage=function(e,t){this.messageListener&&this.messageListener.off(e,t)},n.prototype.listenSocket=function(){if(this.socket){var t=this;this.socket.onopen=function(){t.openListener&&t.openListener.execute()},this.socket.onclose=function(){try{t.closeListener&&t.closeListener.execute()}catch(e){}t.disposeListeners(),t.socket=null},this.socket.onerror=function(e){t.errorListener&&t.errorListener.execute(e)},this.socket.onmessage=function(e){t.messageListener&&t.messageListener.execute(e.data)}}},n.prototype.disposeListeners=function(){this.socket&&(this.socket.onclose=this.socket.onopen=this.socket.onerror=this.socket.onmessage=null),this.openListener&&this.openListener.dispose(),this.errorListener&&this.errorListener.dispose(),this.closeListener&&this.closeListener.dispose(),this.messageListener&&this.messageListener.dispose()},n);function n(e){this.cacertPath=null,this.socket=null,this.channelName=e.channelName,this.cacertPath=e.cacertPath}e.CCWebsocketNetworkChannel=t}(ccPlugins=ccPlugins||{});
var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])};return function(n,t){function r(){this.constructor=n}e(n,t),n.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),NetworkServiceSignalRoutingPlugin=function(n){function e(){return n.call(this)||this}return __extends(e,n),e.registerCommandSignalTransfer=function(n,t){if(e.commandSignalTransfer[n])throw new Error("can not register duplicated command signal transfer, channelName:"+n);e.commandSignalTransfer[n]=t},e.unRegisterCommandSignalTransfer=function(n){delete e.commandSignalTransfer[n]},e.prototype.route=function(n,t){var r=e.commandSignalTransfer[n];if(!r)throw new Error("make sure commandSignalTransfer has been setted!");r(t.innerData[0]).dispatch(t.innerData[1])},e.prototype.onStart=function(n,t){n.success()},e.prototype.onStop=function(n){n.success()},e.prototype.onRestart=function(n){n.success()},e.pluginName="NetworkServiceSignalRoutingPlugin",e.commandSignalTransfer={},e}(rigger.AbsServicePlugin);
var rigger,__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var r in o)o.hasOwnProperty(r)&&(t[r]=o[r])};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();!function(n){var t,o,r;function e(){var t=o.call(this)||this;return t.protocoBufferClassKey="_proto_class_",t}t=n.service||(n.service={}),o=n.AbsServicePlugin,__extends(e,o),e.prototype.encode=function(t,o){var r=t.innerData;return n.utils.Utils.isArray(r)?o.outterData=t.outterData=this.encodeDatas(r):o.outterData=t.outterData=this.doEncode(r),o},e.prototype.decode=function(t,o){if(!o)return o;var r,e=o.innerData;return e&&(r=n.utils.Utils.isArray(e)?this.decodeDatas(e):this.doDecode(e),o.innerData=r),o},e.prototype.doEncode=function(t){return t.__proto__&&t.__proto__.constructor&&t.__proto__.constructor.encode?t.__proto__.constructor.encode(t).finish():t},e.prototype.doDecode=function(t){var o=t[this.protocoBufferClassKey];return o?this.decodeProtoBuffer(o,new Uint8Array(t)):t},e.prototype.decodeProtoBuffer=function(t,o){return t?t.decode(o):null},e.prototype.onStart=function(t,o){t.success()},e.prototype.onStop=function(t){t.success()},e.prototype.onRestart=function(t){t.success()},e.prototype.encodeDatas=function(t){for(var o=[],r=0;r<t.length;++r)o.push(this.doEncode(t[r]));return o},e.prototype.decodeDatas=function(t){for(var o=[],r=0;r<t.length;++r)o.push(this.doDecode(t[r]));return o},r=e,t.ProtobufferEncoderPlugin=r}(rigger=rigger||{});
var __extends=this&&this.__extends||function(){var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}(),__decorate=this&&this.__decorate||function(t,e,r,o){var a,n=arguments.length,i=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var s=t.length-1;0<=s;s--)(a=t[s])&&(i=(n<3?a(i):3<n?a(e,r,i):a(e,r))||i);return 3<n&&i&&Object.defineProperty(e,r,i),i},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ProtocolCmdAssemblerPlugin=function(e){function t(){var t=e.call(this)||this;return t.protocoBufferClassKey="_proto_class_",t}return __extends(t,e),(i=t).prototype.assembleNetworkPackage=function(t,e){if(!rigger.utils.Utils.isArray(t.outterData))return t;if(t.outterData.length<=0)return t;var r=t.outterData[0],o=new rigger.utils.Byte;o.writeUint16(r);for(var a=1;a<t.outterData.length;++a)o.writeArrayBuffer(t.outterData[a]);return o.pos=0,e.outterData=t.outterData=o,e},t.prototype.unAssembleNetworkPackage=function(t,e){if(e.outterData instanceof ArrayBuffer){var r=i.cmdTransfer[t.channelName];if(!r)throw new Error("make sure have setted 'cmdTransfer'");var o=new rigger.utils.Byte(e.outterData),a=this.readHeader(o);o.clear(),o.writeArrayBuffer(t.outterData,2);var n=o.buffer;n[this.protocoBufferClassKey]=r(a),e.innerData=[a,n]}return e},t.registerCommandTransfer=function(t,e){if(i.cmdTransfer[t])throw new Error("can not register duplicated command transfer");i.cmdTransfer[t]=e},t.unRegisterCommandTransfer=function(t){delete i.cmdTransfer[t]},t.prototype.onStart=function(t,e){t.success()},t.prototype.onStop=function(t){t.success()},t.prototype.onRestart=function(t){t.success()},t.prototype.readHeader=function(t){return t.pos=0,t.getUint16()},t.pluginName="ProtocolCmdAssemblerPlugin",t.cmdTransfer={},t=i=__decorate([rigger.utils.DecoratorUtil.register,__metadata("design:paramtypes",[])],t);var i}(rigger.AbsServicePlugin);
var ccPlugins,__extends=this&&this.__extends||function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();!function(t){var r=(i.create=function(t,e){var r=rigger.service.PoolService.getItemByClass(i.POOL_SIGN,i);return r.caller=e,r.parent=t,r},i.prototype.recover=function(){this.dispose(),rigger.service.PoolService.recover(i.POOL_SIGN,this)},i.prototype.removeAt=function(t){return t<this.handlers.length&&(this.handlers=rigger.utils.Utils.removeAtFromArray(this.handlers,t)),this.handlers.length},i.prototype.remove=function(e){var r=[];this.handlers.forEach(function(t){e!==t&&r.push(t)}),this.handlers=r,this.checkIfKeep()},i.prototype.checkIfKeep=function(){this.handlers||this.recover(),this.handlers.length<=0&&this.recover()},i.prototype.dispose=function(){for(var t=0;t<this.handlers.length;++t)this.handlers[t].dispose(!1);this.handlers=[],this.caller=null,this.parent&&(this.parent.remove(this),this.parent=null)},i.POOL_SIGN="_CCTIMER_PLUGIN_CALLBACK_SPEC_SIGN",i);function i(){this.handlers=[]}t.CCTimerPluginCallbackSpec=r;var a=(l.create=function(t,e,r,i,n){void 0===n&&(n=null);var s=rigger.service.PoolService.getItemByClass(l.POOL_SIGN,l);return s.init(t,e,r,i,n),s},l.prototype.recover=function(){this.dispose(),rigger.service.PoolService.recover(l.POOL_SIGN,this)},l.prototype.execute=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.handler.runWith(t),rigger.utils.Utils.isNullOrUndefined(this.restTimes)||(this.restTimes-=1,this.restTimes<=0&&this.recover())},l.prototype.compare=function(t){return this.handler&&this.handler.method===t},l.prototype.init=function(t,e,r,i,n){void 0===n&&(n=null),this.parent=e,this.handler=rigger.RiggerHandler.create(e.caller,r,i,!1),this.callback=t,this.restTimes=n},l.prototype.dispose=function(t){void 0===t&&(t=!0),this.handler&&this.handler.recover(),this.handler=null,this.parent&&(this.callback&&this.parent.parent.unschedule(this.callback),this.callback=null,t&&this.parent.remove(this),this.parent=null),this.restTimes=null},l.POOL_SIGN="_CCTIMER_PLUGIN_HANDLER_SPEC_SIGN",l);function l(){}t.CCTimerPluginHandlerSpec=a;var e,n=(e=rigger.AbsServicePlugin,__extends(s,e),s.prototype.unschedule=function(t){this.applicationEntity&&this.applicationEntity.unschedule(t)},s.prototype.schedule=function(t,e,r,i){this.applicationEntity&&this.applicationEntity.schedule(t,e,r,i)},s.prototype.loop=function(t,e,r,i,n,s){this.addListener(t,cc.macro.REPEAT_FOREVER,e,r,i,n)},s.prototype.once=function(t,e,r,i,n){this.addListener(t,0,e,r,i,n)},s.prototype.clear=function(t,e){var r=this.findCallback(t,e),i=r[0],n=r[1];0<=i&&0<=n&&this.callbacks[i].handlers[n].recover()},s.prototype.clearAll=function(e){var t=rigger.utils.Utils.findIndexFromArray(this.callbacks,function(t){return t.caller==e});0<=t&&this.callbacks[t].recover()},s.prototype.remove=function(t){for(var e=[],r=0;r<this.callbacks.length;++r)this.callbacks[r]!==t&&e.push(this.callbacks[r]);this.callbacks=e},s.prototype.onStart=function(t,e){this.applicationEntity=e.applictionEntity,t.success()},s.prototype.onStop=function(t){t.success()},s.prototype.onRestart=function(t){t.success()},s.prototype.findCallback=function(t,e){for(var r=this.callbacks.length,i=0;i<r;++i)if(this.callbacks[i].caller===t){for(var n=0;n<this.callbacks[i].handlers.length;++n)if(e===this.callbacks[i].handlers[n].handler.method)return[i,n];return[i,-1]}return[-1,-1]},s.prototype.addNewHandler=function(t,e,r,i,n){var s=this.initCallbackSpec(r),l=null;e!=cc.macro.REPEAT_FOREVER&&(l=e+1);var c=a.create(function(t){c.execute([t])},s,i,n,l);s.handlers.push(c),t/=1e3,this.applicationEntity.schedule(c.callback,t,e,t)},s.prototype.initCallbackSpec=function(t){if(rigger.utils.Utils.isNumber(t))return this.callbacks[t];var e=r.create(this,t);return this.callbacks.push(e),e},s.prototype.addListener=function(t,e,r,i,n,s){r=r||null;var l=this.findCallback(r,i),c=l[0],a=l[1];if(0<=c)if(0<=a){if(!s)return;this.unschedule(this.callbacks[c].handlers[a].callback),this.callbacks[c].removeAt(a),this.addNewHandler(t,e,c,i,n)}else this.addNewHandler(t,e,r,i,n);else this.addNewHandler(t,e,r,i,n)},s);function s(){var t=e.call(this)||this;return t.callbacks=[],t}t.CCTimerPlugin=n}(ccPlugins=ccPlugins||{});